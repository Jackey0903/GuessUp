<view class="container">
  <view class="header">
    <text class="title">å¤šäººè”æœºå¤§å…</text>
    <text class="subtitle">REAL-TIME MULTIPLAYER</text>
  </view>

  <view class="room-card glass">
    <view class="status-indicator {{isHost ? 'host' : 'guest'}}">
      <view class="dot"></view>
      <text>{{statusText}}</text>
    </view>
    
    <view class="room-id" wx:if="{{roomId}}">
      <text class="label">æˆ¿é—´å·</text>
      <text class="value">{{roomId}}</text>
    </view>

    <!-- Room Configurations -->
    <view class="room-rules glass-panel">
      <!-- Host View -->
      <view class="rules-host" wx:if="{{isHost}}">
        <view class="rule-title">æˆ¿é—´è§„åˆ™è®¾ç½®</view>
        <view class="rule-item">
          <text class="rule-label">é¢˜ç›®æ•°é‡</text>
          <picker bindchange="onConfigChange" data-param="rounds" value="{{configIndexes.rounds}}" range="{{configOptions.rounds}}" range-key="label">
            <view class="rule-picker">{{configOptions.rounds[configIndexes.rounds].label}} â–¼</view>
          </picker>
        </view>
        <view class="rule-item">
          <text class="rule-label">çŒœæµ‹ä¸Šé™</text>
          <picker bindchange="onConfigChange" data-param="guesses" value="{{configIndexes.guesses}}" range="{{configOptions.guesses}}" range-key="label">
            <view class="rule-picker">{{configOptions.guesses[configIndexes.guesses].label}} â–¼</view>
          </picker>
        </view>
        <view class="rule-item">
          <text class="rule-label">é›·è¾¾æ¬¡æ•°</text>
          <picker bindchange="onConfigChange" data-param="radars" value="{{configIndexes.radars}}" range="{{configOptions.radars}}" range-key="label">
            <view class="rule-picker">{{configOptions.radars[configIndexes.radars].label}} â–¼</view>
          </picker>
        </view>
        <view class="rule-item">
          <text class="rule-label">å•é¢˜é™æ—¶</text>
          <picker bindchange="onConfigChange" data-param="time" value="{{configIndexes.time}}" range="{{configOptions.time}}" range-key="label">
            <view class="rule-picker">{{configOptions.time[configIndexes.time].label}} â–¼</view>
          </picker>
        </view>
      </view>

      <!-- Guest View -->
      <view class="rules-guest" wx:else>
        <view class="rule-title">æˆ¿é—´è§„åˆ™</view>
        <view class="rule-tags">
          <text class="rule-tag">{{config.rounds}}é¢˜</text>
          <text class="rule-tag">{{config.guesses === 999 ? 'æ— é™ç›²çŒœ' : config.guesses + 'æ¬¡æœºä¼š'}}</text>
          <text class="rule-tag">{{config.radars === 999 ? 'æ— é™é›·è¾¾' : (config.radars === 0 ? 'ç¦ç”¨é›·è¾¾' : config.radars + 'æ¬¡é›·è¾¾')}}</text>
          <text class="rule-tag">{{config.time === 999 ? 'æ— æ—¶é—´é™åˆ¶' : config.time + 'ç§’'}}</text>
        </view>
      </view>
    </view>
    
    <!-- Player avatars grid -->
    <view class="players-grid">
      <view class="player-slot {{item.isHost ? 'host-slot' : 'guest-slot joined'}}" wx:for="{{playersArray}}" wx:key="id">
        <view class="avatar">{{item.name[0] || '?'}}</view>
        <view class="name-badge">
           <text class="name">{{item.name}}</text>
           <text class="host-tag" wx:if="{{item.isHost}}">æˆ¿ä¸»</text>
        </view>
      </view>
      
      <!-- Empty slots (pad to 4) -->
      <view class="player-slot guest-slot waiting" wx:for="{{[1,2,3,4]}}" wx:key="*this" wx:if="{{index >= playersArray.length}}">
        <view class="avatar">?</view>
        <text class="name">ç­‰å¾…åŠ å…¥</text>
      </view>
    </view>
  </view>

  <view class="actions">
    <!-- Host Start Game Button -->
    <button 
      wx:if="{{isHost && playersArray.length >= 2 && roomState === 'waiting'}}" 
      class="primary action-btn start-game-btn" 
      bindtap="startGame"
    >
      ğŸš€ å¼€å§‹æ¸¸æˆ ({{playersArray.length}}/4)
    </button>
  
    <!-- Host Invite Button -->
    <button 
      wx:if="{{isHost && playersArray.length < 4 && roomId}}" 
      class="ghost action-btn share-btn" 
      open-type="share"
    >
      é‚€è¯·å¾®ä¿¡å¥½å‹
    </button>
    
    <!-- Dev simulate -->
    <button 
      wx:if="{{isHost && playersArray.length < 4 && roomId}}" 
      class="ghost action-btn" 
      bindtap="devSimulateJoin" 
      style="border: 1px dashed rgba(255,255,255,0.3); margin-top: 10rpx; color: var(--muted); font-size: 24rpx; padding: 10rpx;"
    >
      + [æµ‹è¯•] å¡å…¥1åæœºå™¨äºº
    </button>
    
    <button 
      class="ghost action-btn" 
      bindtap="leaveRoom"
      style="margin-top: 20rpx;"
    >
      è¿”å›é¦–é¡µ
    </button>
  </view>
</view>
